/*
 * Copyright (C) 2015-2017 Christian Friedl <Mag.Christian.Friedl@gmail.com>
 *
 * This file is part of SteerGlance.
 *
 * SteerGlance is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, see <http://www.gnu.org/licenses/>.
 */

const qs = require('querystring');

/**
 * The router - a module, not a class, since it only depends on exactly one input
 *
 * @module web.server.router
 * @function route
 * @param {Object} request
 * @return Object
 */
function route(url) {
    let controller = null;
    let action = null;
    let query = undefined;

    if ( url === '/' ) {
        controller = 'index';
        action = 'index';
    } else if ( url.match(/(\.js|\.css)$/) ) {
        controller = 'index';
        action = 'serveFile';
    } else if ( url.match(/^(\/([\w\-_]+)){1,2}(\?([\w\-%_&=]+))?$/) ) {
        const parts = url.split('?');
        if (parts.length === 2) {
            const queryString = parts.pop();
            query = qs.parse(queryString);
        }
        const path = parts[0].split('/');
        controller = typeof(path[1]) === 'string' ? path[1] : 'index';
        action = typeof(path[2]) === 'string' ? path[2] : 'index';
    } else if ( url.match(/\.ico$/) ) {
        controller = 'error';
        action = 'error';
    } else {
        throw new Error('unable to route');
    }

    return {controllerName: controller, actionName: action, query: query};
}

exports.route = route;
