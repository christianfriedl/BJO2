/*
 * Copyright (C) 2015,2016 Christian Friedl <Mag.Christian.Friedl@gmail.com>
 *
 * This file is part of SteerGlance.
 *
 * SteerGlance is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, see <http://www.gnu.org/licenses/>.
 */

/**
 * @module router
 * @function route
 * @param {Object} request
 * @return Object
 */
function route(url) {
    var module = null;
    var controller = null;
    var action = null;
    var err = false;
    var query = undefined;

    if ( url === '/' ) {
        module = 'index';
        controller = 'index';
        action = 'index';
    } else if ( url.match(/(\.js|\.css)$/) ) {
        module = 'index';
        controller = 'index';
        action = 'serveFile';
    } else if ( url.match(/^(\/([\w\-_]+)){1,3}(\?([\w\-%_&=]+))?$/) ) {
        var parts = url.split('?');
        var queryString = null;
        if (parts.length === 2) {
            queryString = parts.pop();
            var qs = require('querystring');
            query = qs.parse(queryString);
        }
        var path = parts[0].split('/');
        module = typeof(path[1]) === 'string' ? path[1] : 'index';
        controller = typeof(path[2]) === 'string' ? path[2] : 'index';
        action = typeof(path[3]) === 'string' ? path[3] : 'index';
    } else if ( url.match(/\.ico$/) ) {
        module = 'error';
        controller = 'error';
        action = 'error';
    } else {
        throw new Error('unable to route');
    }

    return {moduleName: module, controllerName: controller, actionName: action, query: query};
}

exports.route = route;
